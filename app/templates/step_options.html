{% extends "base_step.html" %}

{% block content %}
<div class="flex flex-col items-center justify-center min-h-[calc(100vh-120px)] px-4">

    <!-- Main Card -->
    <div class="w-full max-w-md bg-[#111] border border-white/10 rounded-2xl p-6 shadow-2xl relative z-10">

        <form action="/app/options" method="POST" class="space-y-6">

            <!-- Header -->
            <div class="text-center space-y-1">
                <h2 class="text-xl font-bold text-white">Clip preferences</h2>
                <p class="text-xs text-gray-400">Customize how your clips are generated</p>
            </div>

            <!-- Clip Length Dropdown -->
            <div class="space-y-2 relative" id="dropdown-container">
                <label class="text-xs font-bold text-gray-400 uppercase tracking-wider">Clip Length</label>

                <button type="button" id="dropdown-trigger"
                    class="w-full bg-[#1a1a1a] text-white text-sm rounded-xl px-4 py-3 border border-white/10 flex items-center justify-between hover:border-white/30 transition">
                    <span id="selected-option">Auto (&lt;90s)</span>
                    <i class="fa-solid fa-chevron-down text-gray-500 text-xs"></i>
                </button>

                <!-- Custom Dropdown Menu -->
                <div id="dropdown-menu"
                    class="hidden absolute top-full left-0 right-0 mt-2 bg-white border border-white/10 rounded-xl shadow-xl overflow-hidden z-50 max-h-64 overflow-y-auto">
                    <div class="p-1 space-y-0.5">
                        <div class="dropdown-item px-3 py-2 hover:bg-gray-100 rounded-lg cursor-pointer flex items-center gap-2 text-sm text-black"
                            data-value="auto">
                            <i class="fa-solid fa-check text-green-500 opacity-0 selected-icon"></i>
                            Auto (&lt;90s)
                        </div>
                        <div class="dropdown-item px-3 py-2 hover:bg-gray-100 rounded-lg cursor-pointer flex items-center gap-2 text-sm text-black"
                            data-value="30">
                            <i class="fa-solid fa-check text-green-500 opacity-0 selected-icon"></i>
                            &lt;30s
                        </div>
                        <div class="dropdown-item px-3 py-2 hover:bg-gray-100 rounded-lg cursor-pointer flex items-center gap-2 text-sm text-black"
                            data-value="30-60">
                            <i class="fa-solid fa-check text-green-500 opacity-0 selected-icon"></i>
                            30s-60s
                        </div>
                        <div class="dropdown-item px-3 py-2 hover:bg-gray-100 rounded-lg cursor-pointer flex items-center gap-2 text-sm text-black"
                            data-value="60-90">
                            <i class="fa-solid fa-check text-green-500 opacity-0 selected-icon"></i>
                            60s-90s
                        </div>
                        <div class="dropdown-item px-3 py-2 hover:bg-gray-100 rounded-lg cursor-pointer flex items-center gap-2 text-sm text-black"
                            data-value="90-180">
                            <i class="fa-solid fa-check text-green-500 opacity-0 selected-icon"></i>
                            90s-3m
                        </div>
                    </div>
                </div>

                <!-- Hidden Input -->
                <input type="hidden" name="duration" id="duration-input" value="auto">
            </div>

            <!-- Topic / Category (Simplified) -->
            <div class="space-y-2">
                <label class="text-xs font-bold text-gray-400 uppercase tracking-wider">Topic Filter</label>
                <select name="category"
                    class="w-full bg-white text-black text-sm rounded-xl px-4 py-3 border border-white/10 focus:outline-none focus:border-white/30 cursor-pointer">
                    <option value="general">General Highlights</option>
                    <option value="podcast">Podcast / Interview</option>
                    <option value="educational">Educational / How-to</option>
                    <option value="gaming">Gaming</option>
                </select>
            </div>

            <!-- Navigation -->
            <div class="pt-4 flex items-center justify-end gap-3">
                <a href="/app/source"
                    class="px-5 py-2.5 rounded-xl border border-white/15 text-sm font-medium text-gray-300 hover:text-white hover:border-white/40 transition">
                    Back
                </a>
                <button type="submit"
                    class="px-6 py-2.5 rounded-xl bg-white text-black font-bold text-sm hover:bg-gray-200 transition transform active:scale-[0.98] flex items-center gap-2">
                    <span>Next</span>
                    <i class="fa-solid fa-arrow-right"></i>
                </button>
            </div>

        </form>
    </div>

</div>

<script>
    const trigger = document.getElementById('dropdown-trigger');
    const menu = document.getElementById('dropdown-menu');
    const input = document.getElementById('duration-input');
    const selectedText = document.getElementById('selected-option');
    const items = document.querySelectorAll('.dropdown-item');

    // Toggle Menu
    trigger.addEventListener('click', (e) => {
        e.stopPropagation();
        menu.classList.toggle('hidden');
    });

    // Close on click outside
    document.addEventListener('click', () => {
        menu.classList.add('hidden');
    });

    // Selection Logic
    items.forEach(item => {
        item.addEventListener('click', () => {
            const value = item.dataset.value;
            const text = item.textContent.trim();

            // Update UI
            selectedText.textContent = text;
            input.value = value;

            // Update Icons
            document.querySelectorAll('.selected-icon').forEach(i => i.classList.add('opacity-0'));
            item.querySelector('.selected-icon').classList.remove('opacity-0');

            menu.classList.add('hidden');
        });
    });

    // Set initial active state
    const initialItem = document.querySelector(`.dropdown-item[data-value="${input.value}"]`);
    if (initialItem) {
        initialItem.querySelector('.selected-icon').classList.remove('opacity-0');
    }
</script>
{% endblock %}